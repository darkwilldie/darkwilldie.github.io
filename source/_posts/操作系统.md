---
title: 操作系统
date: 2024-12-16 21:06:07
tags:
categories: OS
---
<!-- toc -->

## 文件管理

### 管理空闲磁盘块

位图，空闲磁盘块表，空闲磁盘块链，文件分配表（FAT），成组链接法。

### 页替换算法

FIFO（先进先出），LRU（最近最少使用），LFU（最不经常使用），OPT（最佳替换算法）。

## 内存管理

### 分页系统

<img src="https://gitee.com/dwd1201/image/raw/master/202412181117928.png"/>

段表象/页表项不包括段号/页号，包括段/页的物理起址，段/页的大小，权限，状态等。

- 页表项

| 页号 | 页框号 |
|------|--------|
| 0    | 10    |
| 1    | 15    |
| 2    | 16    |

1. 根据逻辑地址找到页号、页内偏移
2. 根据页表起址、页号、页表项长度，找到页表项物理地址
    - 页表项物理地址=页表起址+页号*页表项长度

3. 在页表项中找到页框号，根据页内地址，找到物理地址

    - 物理地址=页框号*页大小+页内偏移

#### 二级分页

- 页目录项

| 页目录号 | 页表项起址 |
|----------|------------|
| 0        | 1000       |
| 1        | 1003       |
| 2        | 1006       |

需要参照页目录项找到页表项起址，再参照页表项找到页框号

| 页目录号（10位） | 页号（10位） | 页内偏移（12位） |
|------------------|--------------|------------------|

如虚拟地址$2050\ 1225H$，写为二进制是$(0002\ 0000\ 0101\ 0000\ 0001\ 0002\ 0002\ 0101)_2$

1. 从虚拟地址中提取出页目录号，页号，页内偏移

    - 页目录号=081H（二进制前10位）
    - 页号=101H（二进制中间10位）
    - 页内偏移=225H（二进制最后12位，十六进制最后三位）

2. 根据页目录起址、页目录号、页目录项长度，找到页目录项物理地址

    - 页目录项物理地址=页目录起址+页目录号*页目录项长度

3. 在页目录项中找到页表起址，根据页号、页表项长度，找到页表项物理地址

    - 页表项物理地址=页表起址+页号*页表项长度

4. 在页表项中找到页框号，根据页内偏移，找到物理地址

    - 物理地址=页框号*页大小+页内偏移

### 动态分区分配算法

<img src="https://gitee.com/dwd1201/image/raw/master/202412171204112.png"/>

#### 内存碎片分类

- 外部碎片：空闲分区之间无法利用的碎片。
- 内部碎片：分配给进程的内存空间中未被使用的部分。

#### 首次适应算法

每次都从低地址开始查找，找到第一个能满足大小的空闲分区。

- 优点：会更有可能用到低地址部分的小分区，也会更有可能把高地址部分的大分区保留下来（最佳适应算法的优点）。
- 缺点：低地址部分出现很多碎片，每次查找都要经过这些碎片，增加了查找开销。

#### 最佳适应算法

优先使用更小的空闲区。

- 优点：把大分区保留下来。
- 缺点：每次都使用更小的空闲区，会留下越来越多的、很小的、难以利用的内存块。**最容易产生内存碎片**。 

#### 最坏适应算法

优先使用最大的空闲区。

- 优点：剩余的空闲区不会太小，更方便使用。
- 缺点：会导致较大的连续空闲区被迅速用完。如果之后有“大进程”到达，就没有内存分区可用了。

#### 邻近适应算法

每次都从上次查找结束的位置开始查找，找到第一个能满足大小的空闲分区。

- 优点：解决首次适应算法的查找开销问题。
- 缺点：高地址部分的大分区更可能被使用，划分为小分区，最后导致无大分区可用（最佳适应算法的缺点）。

#### 总结

<img src="https://gitee.com/dwd1201/image/raw/master/202412171212776.png"/>

### 临界资源互斥同步原则

空闲让进，忙则等待，有限等待，让权等待。

## 磁盘管理

### 磁盘构造

参考[博客园](https://www.cnblogs.com/Mount256/p/17044057.html)

<img src="https://gitee.com/dwd1201/image/raw/master/202412171434794.png"/>

一个柱面（所有同一位置的磁道）有多个盘面（或磁头），一个盘面有多个扇区。

- 地址结构：可用`【柱面号（磁道号），盘面号（磁头号），扇区号】`决定任意一个磁盘块的位置。
- 磁盘容量的计算公式：`磁盘容量 = 柱面数 * 每个柱面的磁道数 * 每个磁道的扇区数 * 扇区大小`。
- 块/簇：每个簇（块）可以包括 n 个扇区。簇（块）是操作系统与磁盘打交道的最小单位，文件所占用的空间必须是簇（块）的整数倍（若文件大小小于一簇，那么也要占一簇的空间）。

## 进程管理

### 死锁

- 死锁的必要条件：互斥条件、请求和保持条件、不剥夺条件、环路等待条件。
- 死锁的预防：破坏死锁的必要条件。
    - 破坏请求和保持条件：一次性分配所有资源、分配前释放所有资源。
    - 破坏不剥夺条件：允许进程暂时释放所占资源。
    - 破坏环路等待条件：有序分配资源。
- 死锁的避免：银行家算法。
- 死锁的检测：资源分配图。
- 死锁的解除：撤销进程、剥夺资源、撤销环路。

### 进程调度

- 进程调度算法：先来先服务、短作业优先、高响应比优先、时间片轮转、多级反馈队列。
- 进程调度方式：抢占式、非抢占式。
- 进程调度时机：进程主动放弃、进程被动放弃、进程异常终止。
- 进程调度方式：抢占式、非抢占式。
- 进程调度时机：进程主动放弃、进程被动放弃、进程异常终止。
